<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: Node</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: Node</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>Node<span class="signature">(info, netInfoUrl)</span><span class="type-signature"></span></h2>
        
            <div class="class-description"><p>Base class for any Node in the distributed network (e.g., Client or Router).</p>
<p>Each Node maintains a periodic interval to:</p>
<ul>
<li>Refresh its token</li>
<li>Send its current node info to the Net service via HTTP and receive an updated <code>NetInfo</code></li>
<li>Clean up inactive sockets (based on inactivity timeout)</li>
<li>Remove requested sockets to routers no longer present in the current <code>NetInfo</code></li>
<li>Establish new requested sockets to routers listed in the latest <code>NetInfo</code></li>
</ul>
<p>Sockets are managed using <code>EmitterAdapter</code> instances and organized into two main ensembles:</p>
<ul>
<li><code>acceptedSockets</code>: inbound WebSocket connections accepted by this node</li>
<li><code>requestedSockets</code>: outbound WebSocket connections initiated by this node to routers</li>
</ul>
<p>Both socket ensembles are aggregated under a common <code>sockets</code> ensemble.
When a socket is closed, it is automatically removed from all ensembles.</p>
<p>Nodes communicate with routers using WebSocket-based <code>Message</code> instances, including:</p>
<ul>
<li><code>Token</code>, <code>Info</code>, <code>Call</code>, <code>Result</code></li>
</ul>
<p>Communication with the central Net service is done via HTTP.</p>
<p>Socket events (<code>message</code>, <code>error</code>, <code>close</code>) are intercepted at the top-level <code>sockets</code> ensemble and delegated to corresponding handler methods:</p>
<ul>
<li><code>handleMessage</code></li>
<li><code>handleError</code></li>
<li><code>handleClose</code></li>
</ul>
<p>These methods can be overridden in subclasses. The default implementation:</p>
<ul>
<li>Removes the closed socket from the structure</li>
<li>Emits the original socket event on the Node (which inherits from <code>Player</code>)</li>
</ul>
<p>Node emits the following events:</p>
<ul>
<li><code>'updating'</code>, <code>'updated'</code>, <code>'gc'</code> — before and after the interval-based update loop</li>
<li><code>'fetching'</code>, <code>'fetched'</code> — before and after each HTTP request to the Net</li>
<li><code>[Message.type]</code> — for each incoming WebSocket message (e.g., <code>'Call'</code>, <code>'Result'</code>)</li>
</ul></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="Node"><span class="type-signature"></span>new Node<span class="signature">(info, netInfoUrl)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Constructs a Node instance.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>info</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="NodeInfo.html">NodeInfo</a></span>


            
            </td>

            

            

            <td class="description last"><p>Info describing/configuring this node (e.g., ID, location, connectivity).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>netInfoUrl</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>URL for retrieving NetInfo periodically via HTTP.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















    
    </div>

    

    

    
        <h3 class="subsection-title">Classes</h3>

        <dl>
            <dt><a href="Node.html">Node</a></dt>
            <dd></dd>
        </dl>
    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="_closeCue"><span class="type-signature"></span>_closeCue<span class="type-signature"> :Cue</span></h4>




<div class="description">
    <p>Listens for closed WebSockets and invokes this.handleClose().</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Cue</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="_errorCue"><span class="type-signature"></span>_errorCue<span class="type-signature"> :Cue</span></h4>




<div class="description">
    <p>Listens for WebSocket errors and invokes this.handleError().</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Cue</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="_messageCue"><span class="type-signature"></span>_messageCue<span class="type-signature"> :Cue</span></h4>




<div class="description">
    <p>Listens for messages and invokes this.handleMessage().</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Cue</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="_openCue"><span class="type-signature"></span>_openCue<span class="type-signature"></span></h4>




<div class="description">
    <p>Cue for handling 'open' events on sockets.</p>
</div>







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="acceptedSockets"><span class="type-signature"></span>acceptedSockets<span class="type-signature"></span></h4>










<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="info"><span class="type-signature"></span>info<span class="type-signature"> :<a href="NodeInfo.html">NodeInfo</a></span></h4>




<div class="description">
    <p>Describes the state/configuration of this node instance.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="NodeInfo.html">NodeInfo</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="netInfo"><span class="type-signature"></span>netInfo<span class="type-signature"> :<a href="NetInfo.html">NetInfo</a></span></h4>




<div class="description">
    <p>Global state of the network, periodically updated from the net server.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type"><a href="NetInfo.html">NetInfo</a></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="requestedSockets"><span class="type-signature"></span>requestedSockets<span class="type-signature"></span></h4>










<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="sockets"><span class="type-signature"></span>sockets<span class="type-signature"> :Ensemble</span></h4>




<div class="description">
    <p>Contains two sub-ensembles: 'requested' (outgoing) and 'accepted' (incoming).</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Ensemble</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
            
<h4 class="name" id="token"><span class="type-signature"></span>token<span class="type-signature"> :string</span></h4>




<div class="description">
    <p>Token for authenticating with the Net and Routers.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">string</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="closeSocket"><span class="type-signature">(async, abstract) </span>closeSocket<span class="signature">(socket)</span><span class="type-signature"> &rarr; {Promise.&lt;void>}</span></h4>
    

    



<div class="description">
    <p>Gracefully closes a WebSocket connection represented by its adapter.</p>
<p>This method <strong>must be implemented</strong> in a subclass to handle closing logic
appropriate for the environment (e.g., browser WebSocket vs. Node.js <code>ws</code>).</p>
<p>Implementations should:</p>
<ul>
<li>Attempt a clean <code>socket.close()</code> if supported.</li>
<li>In Node.js environments, use <code>socket.terminate?.()</code> as a fallback
if the socket does not close within a reasonable timeout.</li>
</ul>
<p>The socket will be automatically removed from the <code>sockets</code> structure by the base <code>Node</code> class.</p>
<p>This method is invoked by <code>disconnect()</code>, <code>closeInactiveSockets()</code>, and <code>closeOrphanSockets()</code>.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>socket</code></td>
            

            <td class="type">
            
                
<span class="param-type">WebSocket</span>


            
            </td>

            

            

            <td class="description last"><p>The WebSocket instance to close.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        <p>If not overridden in a subclass or if the closing process fails.</p>
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    


<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;void></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="disconnect"><span class="type-signature">(async) </span>disconnect<span class="signature">(adapter)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Gracefully disconnects an adapter by:</p>
<ul>
<li>Pausing it to stop event propagation,</li>
<li>Closing the underlying WebSocket using the abstract <code>this.closeSocket</code>,</li>
<li>Removing it from its parent ensemble.</li>
<li>Removing the machine if becomes empty.</li>
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>adapter</code></td>
            

            <td class="type">
            
                
<span class="param-type">EmitterAdapter</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="doFetch"><span class="type-signature">(async, abstract) </span>doFetch<span class="signature">(url, options)</span><span class="type-signature"> &rarr; {Promise.&lt;Response>}</span></h4>
    

    



<div class="description">
    <p>Performs a low-level fetch with the given options.</p>
<p>This method is called by the base <code>Node.fetch()</code> and must be implemented
by subclasses using either global <code>fetch</code> (browser) or <code>node-fetch</code> (Node.js).</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last"><p>Fetch options including method, headers, and body.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;Response></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="fetch"><span class="type-signature">(async) </span>fetch<span class="signature">(url, method<span class="signature-attributes">opt</span>, body<span class="signature-attributes">opt</span>, token<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Promise.&lt;<a href="Message.html">Message</a>>}</span></h4>
    

    



<div class="description">
    <p>Makes an HTTP request and emits the resulting Message.</p>
<p>This method is used by both client and server nodes to retrieve resources
from the web or a Net server. It delegates the actual HTTP call to
the subclass-implemented <code>doFetch()</code> method.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>The request URL.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>method</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    'GET'
                
                </td>
            

            <td class="description last"><p>HTTP method to use.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>body</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Optional JSON-serializable request body.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>token</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Optional Bearer token for authorization.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>A <code>Message</code> instance from the server response.</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;<a href="Message.html">Message</a>></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="gc"><span class="type-signature">(async) </span>gc<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Closes all WebSocket connections that have not been tagged as updated by the updateSockets() method</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="handleClose"><span class="type-signature"></span>handleClose<span class="signature">(evt)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Handles WebSocket 'close' events.</p>
<p>Default behavior:</p>
<ul>
<li>Removes the closed socket (via its adapter) from the internal socket structure.</li>
</ul>
<p>Subclasses may override this method to implement custom cleanup,
logging, or reconnection strategies.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>evt</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last"><p>The close event object emitted by Cue.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>adapter</code></td>
            

            <td class="type">
            
                
<span class="param-type">EmitterAdapter</span>


            
            </td>

            

            

            <td class="description last"><p>The adapter wrapping the closed WebSocket.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="handleError"><span class="type-signature"></span>handleError<span class="signature">(err)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Handles a WebSocket error event.</p>
<p>Default behavior:</p>
<ul>
<li>Emits a general 'error' event from this Node instance.</li>
</ul>
<p>Subclasses may override this method to perform error-specific handling,
such as logging, retrying connections, or categorizing error types.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>err</code></td>
            

            <td class="type">
            
                
<span class="param-type">Error</span>
|

<span class="param-type">Event</span>


            
            </td>

            

            

            <td class="description last"><p>The error event or object raised by the WebSocket.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="handleInterval"><span class="type-signature">(async) </span>handleInterval<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Periodically updates this Node's state by:</p>
<ul>
<li>Refreshing the authentication token</li>
<li>Broadcasting or updating local NodeInfo</li>
<li>Managing WebSocket connections (opening new, pruning inactive)</li>
</ul>
<p>Prevents overlapping executions using <code>_isUpdating</code> flag.
Emits lifecycle events: 'updating', 'token', 'info', 'updated', and 'error'.</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="handleMessage"><span class="type-signature"></span>handleMessage<span class="signature">(evt)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Handles an incoming message on a WebSocket connection.</p>
<ul>
<li>Renews the <code>lastActivity</code> timestamp to track socket liveness.</li>
<li>Emits an event based on the message <code>type</code>, allowing external handlers to respond.</li>
<li>Emits an <code>'error'</code> event if the message lacks a <code>type</code> field.</li>
</ul>
<p>Subclasses may override this method to implement custom dispatch logic.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>evt</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>The event object passed by the adapter.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>adapter</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>The EmitterAdapter instance wrapping the WebSocket.</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>target</code></td>
            

            <td class="type">
            
                
<span class="param-type">WebSocket</span>


            
            </td>

            

            

            <td class="description last"><p>The originating WebSocket.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>type</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The type of the message.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="requestSocket"><span class="type-signature">(async, abstract) </span>requestSocket<span class="signature">(routerId)</span><span class="type-signature"> &rarr; {Promise.&lt;Adapter>}</span></h4>
    

    



<div class="description">
    <p>Opens a WebSocket connection to the router identified by the given ID.</p>
<p>This method <strong>must be implemented</strong> in a subclass.</p>
<p>It is called during <code>updateSockets()</code> to establish outbound WebSocket connections.
The returned adapter will be added to the <code>requestedSockets</code> ensemble by the base class.</p>
<p>Subclasses should:</p>
<ul>
<li>Construct the WebSocket URL (optionally using <code>Node.upgradeUrl()</code>).</li>
<li>Create and open a WebSocket connection to the target router.</li>
<li>Wrap the socket in an <code>EmitterAdapter</code> or compatible adapter.</li>
<li>Return the adapter, <strong>without</strong> modifying <code>this.requestedSockets</code>.</li>
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>routerId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The ID of the router node to connect to.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        <p>If not overridden in a subclass or if the connection fails.</p>
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    


<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A promise resolving to the connected socket adapter.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise.&lt;Adapter></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="startUpdating"><span class="type-signature"></span>startUpdating<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Starts the periodic updating of sockets.
If already running, it does nothing.</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="stopUpdating"><span class="type-signature"></span>stopUpdating<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Stops the periodic updating of sockets.</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateAcceptedSockets"><span class="type-signature">(async) </span>updateAcceptedSockets<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Marks as updated only sockets whose lastActivity + info.socketInactivityTimeout &gt; now</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateInfo"><span class="type-signature">(async) </span>updateInfo<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Sends this node's <code>info</code> to the Net server and updates local <code>netInfo</code> with the result.</p>
<p>Errors are caught and propagated through <code>handleInterval()</code>.</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateRequestedSockets"><span class="type-signature">(async) </span>updateRequestedSockets<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Creates or updates sockets to the nearest routers
New sockets are created. Sockets already presents are tagged as 'updated' for the gc().
The resulting requestedSockets ensemble has not structure.
Derived classes requiring some structure, like Caller class which groups sockets by machine, may override this method</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        


    





        
            

    

    
    <h4 class="name" id="updateSocket"><span class="type-signature">(async) </span>updateSocket<span class="signature">(machine, routerId)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Creates or updates the socket to the router</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>machine</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>routerId</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateSockets"><span class="type-signature">(async) </span>updateSockets<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Creates or updates each socket</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateToken"><span class="type-signature">(async, abstract) </span>updateToken<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Refreshes or generates a new authentication token for this node.</p>
<p>This method <strong>must be implemented</strong> in a subclass:</p>
<ul>
<li><strong>Client</strong> should override this to retrieve a token from a remote <code>netTokenUrl</code>
using a signed identity or credential.</li>
<li><strong>Server</strong> should override this to generate a token locally using a net secret (e.g., <code>jwtSecret</code>).</li>
</ul>
<p>Called automatically within the update interval loop (<code>handleInterval()</code>).</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>













<h5>Throws:</h5>

        

<dl>
    <dt>
        <div class="param-desc">
        <p>If not overridden in a subclass.</p>
        </div>
    </dt>
    <dd></dd>
    <dt>
        <dl>
            <dt>
                Type
            </dt>
            <dd>
                
<span class="param-type">Error</span>


            </dd>
        </dl>
    </dt>
    <dd></dd>
</dl>


    







        
            

    

    
    <h4 class="name" id=".upgradeUrl"><span class="type-signature">(static) </span>upgradeUrl<span class="signature">(httpUrl)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Converts an HTTP(S) URL to the corresponding WS(S) URL.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>httpUrl</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The URL starting with http:// or https://</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>The equivalent WebSocket URL (ws:// or wss://)</li>
</ul>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-core.html">core</a></li><li><a href="msg%250D%250DAll%2520the%2520messages%2520the%2520nodes%2520can%2520exchange%2520each%2520other%2520or%2520with%2520the%2520web%2520portal%2520or%2520the%2520Net%2520server.%250D%250D-%2520%257B@link%2520Message%257Dmodule_.html">msgAll the messages the nodes can exchange each other or with the web portal or the Net server.- <a href="Message.html">Message</a></a></li></ul><h3>Classes</h3><ul><li><a href="Aura.html">Aura</a></li><li><a href="Call.html">Call</a></li><li><a href="CallerInfo.html">CallerInfo</a></li><li><a href="Client.html">Client</a></li><li><a href="ClientInfo.html">ClientInfo</a></li><li><a href="Gaia.html">Gaia</a></li><li><a href="GaiaAura.html">GaiaAura</a></li><li><a href="HttpAura.html">HttpAura</a></li><li><a href="MachineInfo.html">MachineInfo</a></li><li><a href="Message.html">Message</a></li><li><a href="NetInfo.html">NetInfo</a></li><li><a href="Node.html">Node</a></li><li><a href="NodeInfo.html">NodeInfo</a></li><li><a href="Result.html">Result</a></li><li><a href="RunnerInfo.html">RunnerInfo</a></li><li><a href="Server.html">Server</a></li><li><a href="ServerInfo.html">ServerInfo</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="Vibe.html">Vibe</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Oct 13 2025 20:12:04 GMT+0200 (Ora legale dell’Europa centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>